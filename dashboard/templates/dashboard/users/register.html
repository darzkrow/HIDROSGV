{% extends 'dashboard/base.html' %}
{% load crispy_forms_tags %}
{% block title %}Registro{% endblock %}
{% block content %}

	<div class="col">
		<div class="card shadow-sm">
			<div class="card-header bg-primary text-white">
				<h3 class="card-title mb-0">Registro de usuario</h3>
			</div>
			<div class="card-body">
				<form method="post">
					{% if form.errors %}
						<div class="alert alert-danger">
							{% for field, errors in form.errors.items %}
								{% for error in errors %}
									<div>{{ error }}</div>
								{% endfor %}
							{% endfor %}
						</div>
					{% endif %}
					{% if form.non_field_errors %}
						<div class="alert alert-danger">
							{% for error in form.non_field_errors %}
								<div>{{ error }}</div>
							{% endfor %}
						</div>
					{% endif %}
					{% csrf_token %}
					{# Renderizar el form sin mostrar campos de contraseña si existieran #}
					{% for field in form.visible_fields %}
						{% if field.name not in "password1 password2 password" %}
							<div class="mb-3">
								{{ field.label_tag }}
								{{ field }}
								{% if field.help_text %}
									<div class="form-text">{{ field.help_text }}</div>
								{% endif %}
								{% for err in field.errors %}
									<div class="text-danger small">{{ err }}</div>
								{% endfor %}
							</div>
						{% endif %}
					{% endfor %}

					<div class="alert alert-info">
						La contraseña será generada automáticamente y mostrada al finalizar el registro. El usuario deberá cambiarla al iniciar sesión.
					</div>

					<div class="mb-3">
						<label for="groups" class="form-label">Rol/Grupo</label>
						<select name="groups" id="groups" class="form-control">
							{% for group in groups %}
								<option value="{{ group.id }}">{{ group.name }}</option>
							{% endfor %}
						</select>
					</div>

					<div class="d-flex justify-content-end">
						<button type="submit" class="btn btn-success"><i class="fas fa-user-plus"></i> Registrar</button>
					</div>
				</form>
			</div>
		</div>
	</div>

{% endblock %}
